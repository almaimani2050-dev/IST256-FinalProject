<!DOCTYPE html>
<html>
<head>
   <meta charset="UTF-8" />
   <meta name="viewport" content="width=device-width, initial-scale=1" />
   <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
   <title>Article Publication Option</title>
   <link rel="stylesheet" href="articlePublication.css">
</head>
<body id = "articlePublicationPage">
   <nav class="navbar navbar-dark bg-dark px-4">
      <script type="text/babel" src="articlePublication.jsx"></script>
      <div class="container-fluid d-flex justify-content-between">
         <a class="navbar-brand text-white" href="index.html">PSU Magazine</a>
         <div>
            <a class="nav-link d-inline text-white" href="index.html">Home |</a>
            <a class="nav-link d-inline text-white" href="userSignUp.html">Subscribe |</a>
            <a class="nav-link d-inline text-white" href="jQSearcher.html">Search JSON |</a>
            <a class="nav-link d-inline text-white" href="readLater.html">Read Later |</a>
            <a class="nav-link d-inline text-white" href="articlePublication.html">Filter |</a>
            <a class="nav-link d-inline text-white" href="submissionPage.html">Submit an Article |</a>
            <a class="nav-link d-inline text-white" href="editorialPage.html">Edit Request Form</a></div>
      </div>
   </nav>
   <div id= "root"></div>
   <div class="box">
      <h1>Article Publication</h1><br>
      <form id="publicationForm">
         <div class = "heading">
            <label for="articleTitle" >Article Title</label>
            <input type="text" class="form-control" id="articleTitle" placeholder="Enter article title">
         </div><br>
         <div class="heading">
            <label for="publicationDate" >Publication Date</label>
            <input type="date" class="form-control" id="publicationDate">
         </div><br>

         <div class ="heading">
            <label>Distribution Channel:</label>
         </div>
            <div class="form-check">
               <input class="form-check-input" type="checkbox" value="" id="website">
               <label class="form-check-label" for="website">Website</label>
            </div>
            <div class="form-check">
               <input class="form-check-input" type="checkbox" value="" id="newsletter">
               <label class="form-check-label" for="newsletter">Email Newsletter</label>
            </div>
            <div class="form-check">
               <input class="form-check-input" type="checkbox" value="" id="social">
               <label class="form-check-label" for="social">Social Media</label>
            </div><br>

            <div class="heading">
               <label>Review Status</label>
               <select id="reviewStatus" class="form-select">
                  <option value="">Select review status</option>
                  <option value="Pending Review">Pending Review</option>
                  <option value="Under Review">Under Review</option>
                  <option value="Approved">Approved</option>
                  <option value="Rejected">Rejected</option>
               </select>
            </div><br>

            <div class="heading">
               <label for="editorialNotes">Editorial Notes</label>
               <textarea class="form-control" id="editorNotes" placeholder="Optional notes or comment"></textarea>
            </div>

            <p>
               <button type="submit" id="results" class="btn">Add Articles!</button>
            </p>
         
      </form>

      <button type="button" id="filterBtn" class="btn">Filter Articles</button>
      <div id="resultz"></div>
   </div>
      <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
      <script>
         let json = {
            "projectTheme": "PSU Magazine Subscriber Management",
            "articles": [
               {
                  "id": 1,
                  "articleTitle": "PSU Falls to Oregon 45-37",
                  "publicationDate": "2024-12-08",
                  "channel": "PSU Clubs",
                  "status": "Approved",
                  "notes": "PSU falls to Oregon after a long arduous game"
               },
               {
               "id": 2,
               "articleTitle": "Whats Happening on Campus?",
               "publicationDate": "2010-08-05",
               "channel": "Website",
               "status": "Approved",
               "notes": "Let's talk about Old Main, and Campus Life!"
               }
            ]
          };
          $(document).ready(function () {

            localStorage.setItem("articles", JSON.stringify(json.articles));
          
          $('#publicationForm').submit(function(e) 
          {
            e.preventDefault();

            let channels = "";

            if($('#website').is(':checked')) channels += "Website";
            if($('#newsletter').is(':checked')) channels += "Email Newsletter";
            if($('#social').is(':checked')) channels += "Social Media";
            
            let newArticle = {
               id: Date.now(),
               articleTitle: $('#articleTitle').val(),
               publicationDate: $('#publicationDate').val(),
               channel: channels,
               status: $('#reviewStatus').val(),
               notes: $('#editorNotes').val()
            }

            let articles = JSON.parse(localStorage.getItem('articles'));
            articles.push(newArticle);
            localStorage.setItem('articles', JSON.stringify(articles));

          });

          $('#filterBtn').click(function() {
            let searcher = $('#articleTitle').val().toLowerCase();
            let status = $('#reviewStatus').val();
            let articles = JSON.parse(localStorage.getItem("articles"))
            let output = "";

            for (let i = 0; i < articles.length; i++)
            {
               let a = articles[i];

               let titleFiler = searcher == '' || a.articleTitle.toLowerCase().includes(searcher);
               let statusFilter = status == '' || a.status == status;

               if (titleFiler && statusFilter)
               {
                  output += '<div>';
                  output += '<em>Title:</em> ' + a.articleTitle + '<br>';
                  output += '<em>Date:</em> ' + a.publicationDate + '<br>';
                  output += '<em>Status:</em> ' + a.status + '<br>';
                  output += '<em>Notes:</em> ' + a.notes + '<br>';
                  output += '</div>';
               }
            }

            if (output == '')
            {
               $('#resultz').html('<p>Nothing</p>');
            }
            else
            {
               $('#resultz').html(output)
            }
          });
         });   
      </script>
      <script src = "articlePublication.js"></script>
</body>
</html>